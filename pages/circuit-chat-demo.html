<!--
@license
Copyright (c) 2015 Unify. All rights reserved.
-->

<dom-module id="circuit-chat-demo">

  <script type="text/javascript" src="https://circuitsandbox.net/circuit.js"></script>

  <style is="custom-style">
    circuit-chat {
      width: 200px;
      height: 200px;
      font-size: 13px;
    }
    circuit-chat /deep/ #chatList {
      background-color: white;
    }
    circuit-chat /deep/ #chatInput {
      background-color: white;
    }
    #conversationId {
      width: 245px;
    }
    h3 {
      padding-top: 10px;
    }
  </style>

  <template>
    <p>The <code>circuit-chat</code> element is a simple chat module that can easily be embedded into any website. The conversation ID to use can be passed to the element, or assigned via JavaScript.</p>

    <a href="https://github.com/yourcircuit/circuit-chat" target="_blank">https://github.com/yourcircuit/circuit-chat</a>

    <h3>Live example:</h3>
    <p>Paste a conversation ID of a conversation you are part of and start chatting.</p>
    <input id="email" type="text" placeholder="Logon Email" value="{{email::input}}">
    <input id="password" type="password" placeholder="Logon Password" value="{{password::input}}">
    <button on-click="logon">Logon</button>
    <div><input id="conversationId" type="text" placeholder="Enter a conversation ID" value="{{convId::input}}"></div>
    <br><br>

    <!-- conversation attribute is passed in below in JS. For predefined conversations, the
         conversation can be passed in via HTML -->
    <circuit-chat id="chat" conversation="{{convId}}"></circuit-chat>
    <!-- <iron-localstorage name="circuit-chat-demo-conv-id" value="{{convId}}"></iron-localstorage> -->
  </template>

</dom-module>

<script>
  Polymer({
    is: 'circuit-chat-demo',

    _client: null,

    ready: function () {
      app.pageTitle = 'Polymer element: circuit-chat';
      _client = new Circuit.Client();
      this.$.chat.api = _client;
    },

    logon: function () {
      var self = this;
      _client.logon({email: this.email, password: this.password}).then(function () {
        self.$.conversationId.addEventListener('input', function (evt) {
          if (evt.target.value.length >= 36) {
            // Pass conversation ID to chat example
            self.convId = evt.target.value;
            //this.$.chat.conversation = evt.target.value;
          }
        });

        // Show how circuit-chat fires on-message events
        self.$.chat.addEventListener('on-message', function (message) {
          console.log('Received message: ' + message);
        });        
      });      
    }


  });
</script>
